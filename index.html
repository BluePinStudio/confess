<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Submit Message (JSONP)</title>
</head>
<body>

<h1>Submit Your Message</h1>
<input type="text" id="messageInput" placeholder="Enter text (10-250 chars)">
<button id="submitBtn">Submit</button>
<div id="feedback"></div>

<script>
// Callback function to handle the JSONP response
function handleResponse(data) {
  const feedback = document.getElementById('feedback');
  if (data.status === 'success') {
    feedback.style.color = 'green';
    feedback.textContent = "Success! Your UID: " + data.uid;
  } else {
    feedback.style.color = 'red';
    feedback.textContent = "Error occurred.";
  }
}

// Triggered when user clicks Submit
document.getElementById('submitBtn').addEventListener('click', function() {
  const messageInput = document.getElementById('messageInput');
  const feedback = document.getElementById('feedback');
  const userText = messageInput.value.trim();

  // Validate input length
  if (userText.length < 10) {
    feedback.style.color = 'red';
    feedback.textContent = "Your entry is too short!";
    return;
  }
  if (userText.length > 250) {
    feedback.style.color = 'red';
    feedback.textContent = "Your entry is too long!";
    return;
  }

  feedback.textContent = "Submitting...";

  // Dynamically create a script tag for JSONP
  const script = document.createElement('script');
  // Replace with your actual Web App URL
  const endpointURL = "https://script.google.com/macros/s/AKfycbyeWFWR0kiQoK1rX5CkbG9uxKUWO_MsXIVr9viFbVGXFq5Idm-t5cYlyYlEzbcNLTwPTQ/exec";

  // Append parameters including callback and text
  script.src = endpointURL + "?callback=handleResponse&text=" + encodeURIComponent(userText);
  
  // Append script to document to initiate the request
  document.body.appendChild(script);

  // After loading, script will call `handleResponse(data)`
});
</script>

</body>
</html>
